<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TubeEarn Wallet - Create/Login/Connect</title>
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .wallet-box {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    button, input {
      padding: 10px;
      font-size: 16px;
      width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }
    #output {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .note {
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>

<div class="wallet-box">
  <h2>🔐 TubeEarn Wallet System</h2>

  <button onclick="createWallet()">🔁 Create New Wallet</button>

  <input type="text" id="phraseInput" placeholder="Enter 12-word Passphrase to Login" />
  <button onclick="loginWallet()">🔓 Login to Wallet</button>

  <button onclick="simulateUPIPayment()">💸 Simulate UPI Payment</button>
  <button onclick="connectFingerprint()">🔒 Enable Fingerprint</button>

  <div id="output"></div>
</div>

<script>
  let currentWallet = null;

  async function createWallet() {
    const mnemonic = bip39.generateMnemonic();
    const wallet = ethers.ethers.Wallet.fromMnemonic(mnemonic);
    currentWallet = wallet;

    document.getElementById("output").innerText = `
✅ Wallet Created

📜 Mnemonic: ${mnemonic}

📮 Address: ${wallet.address}
🔑 Private Key: ${wallet.privateKey}

⚠️ Please save your phrase and key securely!
    `;
  }

  function loginWallet() {
    const phrase = document.getElementById("phraseInput").value.trim();
    try {
      if (!bip39.validateMnemonic(phrase)) {
        throw new Error("❌ Invalid passphrase");
      }
      const wallet = ethers.ethers.Wallet.fromMnemonic(phrase);
      currentWallet = wallet;

      document.getElementById("output").innerText = `
✅ Login Successful

📮 Address: ${wallet.address}
🔑 Private Key: ${wallet.privateKey}
      `;
    } catch (err) {
      document.getElementById("output").innerText = err.message;
    }
  }

  function simulateUPIPayment() {
    if (!currentWallet) {
      alert("❗Login or create wallet first");
      return;
    }

    // Placeholder: Simulate UPI logic (connect to backend API)
    const paymentRef = "TXN" + Math.floor(Math.random() * 100000);
    document.getElementById("output").innerText += `\n\n💸 Payment Simulated\n🧾 Ref: ${paymentRef}`;
  }

  function connectFingerprint() {
    if (!window.PublicKeyCredential) {
      alert("❌ Fingerprint/WebAuthn not supported");
      return;
    }

    navigator.credentials.get({
      publicKey: {
        challenge: new Uint8Array(26),
        timeout: 60000,
        userVerification: "preferred",
        allowCredentials: []
      }
    }).then(res => {
      document.getElementById("output").innerText += `\n\n🔓 Fingerprint Enabled ✅`;
    }).catch(err => {
      document.getElementById("output").innerText += `\n\n❌ Fingerprint Failed: ${err.message}`;
    });
  }
</script>

</body>
</html>
